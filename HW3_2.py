"""
ChemMath HW3-2
"""
import numpy as np
import scipy.constants as sc
from mpl_toolkits.mplot3d import Axes3D
import matplotlib.pyplot as plt

# Unit transformation
HARTREE2CM = sc.physical_constants['hartree-inverse meter relationship'][0]/100.0
DALTON2AU = sc.atomic_mass/sc.electron_mass

# H2O 的振動分析資料
# k_ij, 單位 Hartree/Bohr^2
k_H2O = np.array([
[-1.00337673e-06,  5.54855472e-16, -4.37508039e-15,  5.01689295e-07, -7.29798440e-15, -2.51814002e-15,  5.01688807e-07,  6.69411612e-15,  6.87625418e-15],
[5.54855472e-16,  6.79990582e-01,  1.65221323e-12, -7.44283374e-15, -3.39995291e-01,  2.66239400e-01,  6.88472968e-15, -3.39995291e-01, -2.66239400e-01],
[-4.37508039e-15,  1.65221323e-12,  4.53582346e-01,  1.95263680e-16,  2.01961010e-01, -2.26791173e-01,  4.19263538e-15, -2.01961010e-01, -2.26791173e-01],
[5.01689295e-07, -7.44283374e-15,  1.95263680e-16, -3.80831565e-07,  3.24879045e-15,  7.12815169e-16, -1.20857720e-07,  4.19827841e-15, -9.25981520e-16],
[-7.29798440e-15, -3.39995291e-01,  2.01961010e-01,  3.24879045e-15,  3.68349284e-01, -2.34100205e-01,  4.06568750e-15, -2.83539932e-02,  3.21391950e-02],
[-2.51814002e-15,  2.66239400e-01, -2.26791173e-01,  7.12815169e-16, -2.34100205e-01,  2.17637061e-01,  1.79769801e-15, -3.21391950e-02,  9.15411178e-03],
[5.01688807e-07,  6.88472968e-15,  4.19263538e-15, -1.20857720e-07,  4.06568750e-15,  1.79769801e-15, -3.80831107e-07, -1.09056395e-14, -5.95546449e-15],
[6.69411612e-15, -3.39995291e-01, -2.01961010e-01,  4.19827841e-15, -2.83539932e-02, -3.21391950e-02, -1.09056395e-14,  3.68349284e-01,  2.34100205e-01],
[6.87625418e-15, -2.66239400e-01, -2.26791173e-01, -9.25981520e-16,  3.21391950e-02,  9.15411178e-03, -5.95546449e-15,  2.34100205e-01,  2.17637061e-01]])

# Mass in Dalton
m_H2O = np.array([15.9949146,   1.00782504,   1.00782504])

# X in Angstrom
xyz_H20 = np.array([
    [0.00000000e+00,   4.13513215e-13,   1.02414982e-01],
    [0.00000000e+00,   7.60504102e-01,  -4.93110491e-01],
    [0.00000000e+00,  -7.60504102e-01,  -4.93110491e-01]])

k = np.array([
[ 6.7739578e-01, -8.6483464e-09, -1.6860906e-12, -5.4024526e-02, -3.2815327e-09, -1.5834024e-13, -2.9663674e-01, -8.7019738e-02,  4.1459835e-13, -1.5596098e-02, -1.4996749e-02,  2.1573290e-14,  2.0771939e-02, -4.9066024e-02,  2.1245516e-13,  1.9878151e-03,  1.0958084e-03, -3.1095330e-16, -4.2697654e-02, -7.5879675e-09, -2.3525014e-13, -1.7274299e-03, -2.0752710e-09,  1.1739949e-14,  2.0771926e-02,  4.9066040e-02,  1.2798962e-13,  1.9878132e-03, -1.0958101e-03, -3.1437398e-14, -2.9663673e-01,  8.7019743e-02,  9.6076720e-13, -1.5596100e-02,  1.4996752e-02,  3.6230575e-13],
[-8.6483464e-09,  7.3318270e-01,  2.4436352e-13, -5.9386292e-10, -3.4661136e-01,  1.8340629e-14, -1.2871365e-01, -1.7208298e-01,  2.9865425e-13,  1.6422765e-02,  9.6824379e-03,  9.5407194e-15, -2.7549563e-02, -2.3462217e-02, -1.5032739e-14,  7.9170892e-04, -5.9769557e-03, -6.0190372e-16, -1.8889391e-08, -3.5892867e-03, -3.8804593e-15,  2.4647488e-10,  6.9737218e-04,  2.0497656e-14,  2.7549584e-02, -2.3462192e-02, -1.5258742e-13, -7.9170992e-04, -5.9769556e-03,  3.5577238e-14,  1.2871366e-01, -1.7208300e-01, -4.5510042e-13, -1.6422765e-02,  9.6824383e-03,  2.2893815e-16],
[-1.6860906e-12,  2.4436352e-13,  1.0437872e-01, -1.6944824e-14,  9.4785535e-15, -3.0977417e-02,  4.3807591e-13,  2.6553338e-13, -3.8477815e-02, -4.9222352e-15, -2.2773471e-14, -5.0038805e-04, -1.6035702e-13,  1.1904640e-13, -9.1063246e-03, -1.0633982e-14, -6.5253551e-15,  8.9872335e-03,  4.5020669e-13,  4.5207180e-14,  6.9790429e-03, -2.1933485e-14, -1.7215623e-14, -2.1856755e-03,  1.1959054e-13, -1.3693895e-13, -9.1063405e-03,  1.5535061e-14,  1.2181102e-14,  8.9872000e-03,  8.4804118e-13, -5.6620280e-13, -3.8477816e-02,  2.9432768e-14,  5.3846077e-14, -5.0042144e-04],
[-5.4024526e-02, -5.9386292e-10, -1.6944824e-14,  5.5225014e-02, -6.8529491e-11,  2.6380756e-14,  3.9802695e-03, -2.6299176e-02, -1.1686377e-14,  8.2339726e-04,  4.2578152e-05,  4.0475085e-15, -4.8030764e-03, -2.8249256e-03, -1.0208621e-14,  1.4494598e-04, -1.6578771e-03, -9.8879711e-17, -1.7274403e-03, -1.0060724e-09,  1.7657259e-14,  2.3587743e-04, -1.0659707e-10, -5.1075900e-16, -4.8030767e-03,  2.8249280e-03, -9.0330852e-15,  1.4494575e-04,  1.6578773e-03, -8.1344367e-16,  3.9802713e-03,  2.6299175e-02, -1.5907448e-14,  8.2339777e-04, -4.2577963e-05,  1.7117913e-14],
[-3.2815327e-09, -3.4661136e-01,  9.4785535e-15, -6.8529491e-11,  3.6376583e-01, -4.0581256e-17,  5.1203165e-03, -9.8939800e-03,  3.6734188e-14, -9.0399188e-05,  8.5100933e-04,  3.4264988e-15, -3.1290074e-03,  8.1394673e-04, -5.1697774e-15,  2.6716329e-04, -6.5798416e-04, -3.2294512e-16, -5.3359221e-09,  6.9737148e-04, -9.9078006e-15,  1.8220778e-10, -7.7827238e-05, -5.1018679e-16,  3.1290131e-03,  8.1395450e-04, -3.0969336e-15, -2.6716351e-04, -6.5798435e-04,  1.6263132e-15, -5.1203137e-03, -9.8939868e-03, -2.6216464e-14,  9.0399342e-05,  8.5100935e-04, -6.0008644e-15],
[-1.5834024e-13,  1.8340629e-14, -3.0977417e-02,  2.6380756e-14, -4.0581256e-17,  2.3560180e-02,  1.0066190e-13,  1.5469943e-13, -5.0039781e-04,  7.3461445e-15,  7.3251539e-15, -3.1325980e-03, -7.7218578e-15, -3.0684169e-14,  8.9872052e-03, -5.4698367e-16, -6.6006825e-16,  6.5247989e-06, -1.9193432e-14, -5.3569124e-15, -2.1856911e-03,  7.0585289e-16, -4.7404092e-16, -1.1185277e-03, -1.4581840e-14,  8.9461872e-16,  8.9872007e-03, -3.1653880e-17, -3.9447678e-16,  6.5196660e-06,  5.4436336e-14, -1.3938849e-13, -5.0039614e-04,  1.0885013e-14, -4.2610905e-15, -3.1326030e-03],
[-2.9663674e-01, -1.2871365e-01,  4.3807591e-13,  3.9802695e-03,  5.1203165e-03,  1.0066190e-13,  7.1923606e-01, -2.4156248e-02, -5.9501506e-13, -2.7346466e-01,  1.2669379e-01, -5.6000091e-14, -1.0980628e-01,  2.0846932e-02, -1.8647945e-14,  2.7452874e-03, -2.7012200e-02,  4.2654243e-15,  2.0771923e-02,  2.7549579e-02, -7.9371319e-15, -4.8030812e-03,  3.1290101e-03,  1.7867295e-14, -1.3366398e-02, -1.6934484e-02,  7.6753782e-15,  9.1154862e-05, -1.0499654e-03, -2.7954966e-15, -4.5579108e-02,  1.0758246e-02,  1.5907717e-13, -3.1684300e-03,  3.7686769e-03, -4.7227360e-14],
[-8.7019738e-02, -1.7208298e-01,  2.6553338e-13, -2.6299176e-02, -9.8939800e-03,  1.5469943e-13, -2.4156248e-02,  6.9134297e-01, -8.0495558e-13,  1.2669378e-01, -1.2717126e-01, -3.7864160e-14, -2.0846958e-02, -3.5891369e-01,  2.0220624e-13,  4.4073014e-03, -8.6590041e-03,  3.6823235e-14,  4.9066048e-02, -2.3462197e-02,  1.4899779e-14,  2.8249197e-03,  8.1395082e-04,  5.2248991e-15, -1.6934492e-02, -3.2920690e-02, -4.2224218e-14, -1.0499612e-03, -1.1212211e-03,  4.0847230e-14, -1.0758256e-02,  4.2888812e-02,  1.7486754e-13,  4.0727830e-03, -8.2071040e-04, -1.0057779e-14],
[ 4.1459835e-13,  2.9865425e-13, -3.8477815e-02, -1.1686377e-14,  3.6734188e-14, -5.0039781e-04, -5.9501506e-13, -8.0495558e-13,  1.0437903e-01, -1.3216064e-14, -1.8006441e-14, -3.0977428e-02,  9.7294958e-14,  1.2046327e-13, -3.8477899e-02,  1.3083833e-14,  3.5761584e-15, -5.0043635e-04, -2.9083163e-13,  5.8322578e-14, -9.1063274e-03, -1.1133252e-14, -4.0240014e-15,  8.9871974e-03,  1.5159720e-13,  4.5519938e-13,  6.9789697e-03, -2.0029354e-15, -2.0439867e-14, -2.1856718e-03,  2.4699605e-13, -1.4108433e-13, -9.1064489e-03,  3.1492022e-16,  1.5560387e-14,  8.9872228e-03],
[-1.5596098e-02,  1.6422765e-02, -4.9222352e-15,  8.2339726e-04, -9.0399188e-05,  7.3461445e-15, -2.7346466e-01,  1.2669378e-01, -1.3216064e-14,  2.8663062e-01, -1.3360207e-01,  2.5306836e-15,  2.7452839e-03, -4.4072988e-03, -2.9829218e-15,  8.6481544e-04,  6.6488117e-05, -4.7511021e-16,  1.9878216e-03, -7.9170787e-04,  6.7839116e-15,  1.4494560e-04, -2.6716268e-04, -7.3659884e-16,  9.1149557e-05, -1.0499694e-03,  1.9325126e-14,  6.0037340e-07,  1.3583921e-04,  3.8127740e-16, -3.1684315e-03, -4.0727806e-03, -1.2073829e-14, -1.0594481e-03,  9.6252118e-04, -1.9603844e-15],
[-1.4996749e-02,  9.6824379e-03, -2.2773471e-14,  4.2578152e-05,  8.5100933e-04,  7.3251539e-15,  1.2669379e-01, -1.2717126e-01, -1.8006441e-14, -1.3360207e-01,  1.3236023e-01,  1.4949940e-14,  2.7012197e-02, -8.6590011e-03,  9.5390636e-15, -6.6489131e-05,  8.0959429e-04,  2.7690139e-15, -1.0958029e-03, -5.9769543e-03, -4.6080664e-15,  1.6578774e-03, -6.5798387e-04,  7.4169269e-16, -1.0499676e-03, -1.1212278e-03,  1.9463331e-14,  1.3583948e-04,  1.5745448e-04, -1.8970854e-15, -3.7686795e-03, -8.2070430e-04, -7.3177909e-15, -9.6252175e-04,  5.4641176e-04, -1.8534065e-16],
[ 2.1573290e-14,  9.5407194e-15, -5.0038805e-04,  4.0475085e-15,  3.4264988e-15, -3.1325980e-03, -5.6000091e-14, -3.7864160e-14, -3.0977428e-02,  2.5306836e-15,  1.4949940e-14,  2.3560183e-02,  9.8116724e-15,  1.9903313e-14, -5.0040275e-04,  9.9408265e-16,  2.5552325e-15, -3.1326037e-03,  3.0988987e-14, -2.7976639e-15,  8.9872092e-03,  1.1884275e-16,  3.6556443e-16,  6.5200391e-06, -1.0704409e-14, -2.3769384e-15, -2.1856854e-03,  9.1577392e-16, -4.7344861e-16, -1.1185270e-03, -4.2006247e-15, -6.4638361e-15,  8.9871978e-03, -7.5716044e-17, -7.6521999e-16,  6.5233979e-06],
[ 2.0771939e-02, -2.7549563e-02, -1.6035702e-13, -4.8030764e-03, -3.1290074e-03, -7.7218578e-15, -1.0980628e-01, -2.0846958e-02,  9.7294958e-14,  2.7452839e-03,  2.7012197e-02,  9.8116724e-15,  7.1923603e-01,  2.4156255e-02,  6.9077993e-13, -2.7346466e-01, -1.2669379e-01,  7.2539162e-14, -2.9663671e-01,  1.2871367e-01, -6.0311154e-13,  3.9802669e-03, -5.1203112e-03, -5.4765058e-14, -4.5579110e-02, -1.0758270e-02, -3.7257452e-14, -3.1684265e-03, -3.7686766e-03,  1.1419505e-14, -1.3366408e-02,  1.6934496e-02,  1.2569453e-14,  9.1151530e-05,  1.0499640e-03, -3.1201743e-14],
[-4.9066024e-02, -2.3462217e-02,  1.1904640e-13, -2.8249256e-03,  8.1394673e-04, -3.0684169e-14,  2.0846932e-02, -3.5891369e-01,  1.2046327e-13, -4.4072988e-03, -8.6590011e-03,  1.9903313e-14,  2.4156255e-02,  6.9134300e-01, -5.6498000e-13, -1.2669378e-01, -1.2717126e-01, -8.4196030e-14,  8.7019748e-02, -1.7208300e-01,  2.8101629e-13,  2.6299181e-02, -9.8939847e-03,  1.5802794e-13,  1.0758244e-02,  4.2888804e-02, -1.1769689e-14, -4.0727850e-03, -8.2071025e-04,  1.5776203e-14,  1.6934487e-02, -3.2920668e-02, -4.3139678e-14,  1.0499653e-03, -1.1212208e-03,  2.0536150e-14],
[ 2.1245516e-13, -1.5032739e-14, -9.1063246e-03, -1.0208621e-14, -5.1697774e-15,  8.9872052e-03, -1.8647945e-14,  2.0220624e-13, -3.8477899e-02, -2.9829218e-15,  9.5390636e-15, -5.0040275e-04,  6.9077993e-13, -5.6498000e-13,  1.0437905e-01,  1.8184855e-14, -1.6099346e-15, -3.0977397e-02, -5.4115627e-13,  2.1601643e-13, -3.8477828e-02, -1.5810527e-15,  4.5876118e-14, -5.0041128e-04, -1.2181942e-13, -2.4267612e-13, -9.1064504e-03, -5.1420297e-15, -5.8938109e-15,  8.9871903e-03, -2.2798971e-13,  3.7669908e-13,  6.9789632e-03,  8.1080318e-15, -1.4974553e-14, -2.1856967e-03],
[ 1.9878151e-03,  7.9170892e-04, -1.0633982e-14,  1.4494598e-04,  2.6716329e-04, -5.4698367e-16,  2.7452874e-03,  4.4073014e-03,  1.3083833e-14,  8.6481544e-04, -6.6489131e-05,  9.9408265e-16, -2.7346466e-01, -1.2669378e-01,  1.8184855e-14,  2.8663062e-01,  1.3360207e-01, -1.1885435e-15, -1.5596099e-02, -1.6422764e-02, -3.6927372e-17,  8.2339782e-04,  9.0399572e-05, -1.0278031e-14, -3.1684290e-03,  4.0727836e-03,  1.5227598e-14, -1.0594486e-03, -9.6252134e-04, -7.5767553e-16,  9.1152817e-05,  1.0499629e-03, -2.4473536e-14,  6.0046679e-07, -1.3583905e-04,  4.2531230e-16],
[ 1.0958084e-03, -5.9769557e-03, -6.5253551e-15, -1.6578771e-03, -6.5798416e-04, -6.6006825e-16, -2.7012200e-02, -8.6590041e-03,  3.5761584e-15,  6.6488117e-05,  8.0959429e-04,  2.5552325e-15, -1.2669379e-01, -1.2717126e-01, -1.6099346e-15,  1.3360207e-01,  1.3236023e-01,  1.6494904e-14,  1.4996750e-02,  9.6824383e-03, -2.1809073e-14, -4.2577972e-05,  8.5100886e-04,  5.3525941e-15,  3.7686784e-03, -8.2070752e-04, -1.0597966e-14,  9.6252098e-04,  5.4641221e-04, -5.0478688e-16,  1.0499652e-03, -1.1212234e-03,  1.5100493e-14, -1.3583885e-04,  1.5745488e-04, -1.3721983e-15],
[-3.1095330e-16, -6.0190372e-16,  8.9872335e-03, -9.8879711e-17, -3.2294512e-16,  6.5247989e-06,  4.2654243e-15,  3.6823235e-14, -5.0043635e-04, -4.7511021e-16,  2.7690139e-15, -3.1326037e-03,  7.2539162e-14, -8.4196030e-14, -3.0977397e-02, -1.1885435e-15,  1.6494904e-14,  2.3560199e-02, -8.6514498e-14,  9.5618951e-15, -5.0040268e-04, -5.9516655e-15,  4.9414764e-15, -3.1326006e-03,  9.8974217e-15,  1.2412715e-14,  8.9871998e-03,  6.4624898e-16, -7.0275379e-16,  6.5154226e-06,  6.8134145e-15,  3.0411888e-15, -2.1856958e-03,  3.7797884e-16, -2.2079647e-16, -1.1185361e-03],
[-4.2697654e-02, -1.8889391e-08,  4.5020669e-13, -1.7274403e-03, -5.3359221e-09, -1.9193432e-14,  2.0771923e-02,  4.9066048e-02, -2.9083163e-13,  1.9878216e-03, -1.0958029e-03,  3.0988987e-14, -2.9663671e-01,  8.7019748e-02, -5.4115627e-13, -1.5596099e-02,  1.4996750e-02, -8.6514498e-14,  6.7739576e-01, -1.2451562e-08,  1.7575026e-12, -5.4024520e-02, -2.4152452e-09,  2.0928366e-13, -2.9663673e-01, -8.7019733e-02, -1.2501195e-12, -1.5596104e-02, -1.4996753e-02, -2.7542910e-13,  2.0771933e-02, -4.9066028e-02,  1.2987414e-14,  1.9878157e-03,  1.0958096e-03,  2.2751042e-15],
[-7.5879675e-09, -3.5892867e-03,  4.5207180e-14, -1.0060724e-09,  6.9737148e-04, -5.3569124e-15,  2.7549579e-02, -2.3462197e-02,  5.8322578e-14, -7.9170787e-04, -5.9769543e-03, -2.7976639e-15,  1.2871367e-01, -1.7208300e-01,  2.1601643e-13, -1.6422764e-02,  9.6824383e-03,  9.5618951e-15, -1.2451562e-08,  7.3318269e-01,  3.7649761e-13,  6.3680389e-10, -3.4661136e-01,  2.3379460e-14, -1.2871365e-01, -1.7208298e-01, -5.8301206e-13,  1.6422764e-02,  9.6824382e-03,  4.6842164e-14, -2.7549572e-02, -2.3462212e-02, -2.0323147e-13,  7.9170917e-04, -5.9769552e-03,  1.8570798e-14],
[-2.3525014e-13, -3.8804593e-15,  6.9790429e-03,  1.7657259e-14, -9.9078006e-15, -2.1856911e-03, -7.9371319e-15,  1.4899779e-14, -9.1063274e-03,  6.7839116e-15, -4.6080664e-15,  8.9872092e-03, -6.0311154e-13,  2.8101629e-13, -3.8477828e-02, -3.6927372e-17, -2.1809073e-14, -5.0040268e-04,  1.7575026e-12,  3.7649761e-13,  1.0437874e-01,  2.3804393e-14,  1.4589289e-14, -3.0977393e-02, -8.1359722e-13, -5.0674386e-13, -3.8477819e-02, -4.3250900e-14,  3.6206455e-14, -5.0039882e-04, -9.5787352e-14, -1.7345622e-13, -9.1063387e-03, -6.7769381e-15, -2.8039331e-15,  8.9872080e-03],
[-1.7274299e-03,  2.4647488e-10, -2.1933485e-14,  2.3587743e-04,  1.8220778e-10,  7.0585289e-16, -4.8030812e-03,  2.8249197e-03, -1.1133252e-14,  1.4494560e-04,  1.6578774e-03,  1.1884275e-16,  3.9802669e-03,  2.6299181e-02, -1.5810527e-15,  8.2339782e-04, -4.2577972e-05, -5.9516655e-15, -5.4024520e-02,  6.3680389e-10,  2.3804393e-14,  5.5225014e-02, -3.0452313e-11, -2.8864391e-14,  3.9802676e-03, -2.6299182e-02,  3.8978589e-14,  8.2339787e-04,  4.2578129e-05, -1.4169802e-14, -4.8030821e-03, -2.8249191e-03,  1.9931493e-14,  1.4494571e-04, -1.6578776e-03,  9.4477565e-17],
[-2.0752710e-09,  6.9737218e-04, -1.7215623e-14, -1.0659707e-10, -7.7827238e-05, -4.7404092e-16,  3.1290101e-03,  8.1395082e-04, -4.0240014e-15, -2.6716268e-04, -6.5798387e-04,  3.6556443e-16, -5.1203112e-03, -9.8939847e-03,  4.5876118e-14,  9.0399572e-05,  8.5100886e-04,  4.9414764e-15, -2.4152452e-09, -3.4661136e-01,  1.4589289e-14, -3.0452313e-11,  3.6376583e-01,  7.3184589e-15,  5.1203146e-03, -9.8939807e-03, -3.4771393e-14, -9.0399469e-05,  8.5100910e-04, -9.4528003e-15, -3.1290087e-03,  8.1394873e-04, -6.4694761e-15,  2.6716247e-04, -6.5798452e-04, -6.8357126e-16],
[ 1.1739949e-14,  2.0497656e-14, -2.1856755e-03, -5.1075900e-16, -5.1018679e-16, -1.1185277e-03,  1.7867295e-14,  5.2248991e-15,  8.9871974e-03, -7.3659884e-16,  7.4169269e-16,  6.5200391e-06, -5.4765058e-14,  1.5802794e-13, -5.0041128e-04, -1.0278031e-14,  5.3525941e-15, -3.1326006e-03,  2.0928366e-13,  2.3379460e-14, -3.0977393e-02, -2.8864391e-14,  7.3184589e-15,  2.3560194e-02, -1.4194371e-13, -2.4419227e-13, -5.0040811e-04, -1.2685786e-14, -9.0057934e-15, -3.1326034e-03,  9.6265032e-15,  3.2395717e-14,  8.9871931e-03,  1.2669254e-15,  7.6983919e-16,  6.5150387e-06],
[ 2.0771926e-02,  2.7549584e-02,  1.1959054e-13, -4.8030767e-03,  3.1290131e-03, -1.4581840e-14, -1.3366398e-02, -1.6934492e-02,  1.5159720e-13,  9.1149557e-05, -1.0499676e-03, -1.0704409e-14, -4.5579110e-02,  1.0758244e-02, -1.2181942e-13, -3.1684290e-03,  3.7686784e-03,  9.8974217e-15, -2.9663673e-01, -1.2871365e-01, -8.1359722e-13,  3.9802676e-03,  5.1203146e-03, -1.4194371e-13,  7.1923605e-01, -2.4156250e-02,  1.0064480e-12, -2.7346466e-01,  1.2669379e-01,  1.3704813e-13, -1.0980628e-01,  2.0846938e-02, -1.4659860e-13,  2.7452871e-03, -2.7012200e-02, -1.7533614e-13],
[ 4.9066040e-02, -2.3462192e-02, -1.3693895e-13,  2.8249280e-03,  8.1395450e-04,  8.9461872e-16, -1.6934484e-02, -3.2920690e-02,  4.5519938e-13, -1.0499694e-03, -1.1212278e-03, -2.3769384e-15, -1.0758270e-02,  4.2888804e-02, -2.4267612e-13,  4.0727836e-03, -8.2070752e-04,  1.2412715e-14, -8.7019733e-02, -1.7208298e-01, -5.0674386e-13, -2.6299182e-02, -9.8939807e-03, -2.4419227e-13, -2.4156250e-02,  6.9134297e-01,  2.0394987e-12,  1.2669378e-01, -1.2717126e-01,  2.5773975e-13, -2.0846945e-02, -3.5891368e-01, -1.4244781e-12,  4.4073007e-03, -8.6590041e-03, -2.0833893e-13],
[ 1.2798962e-13, -1.5258742e-13, -9.1063405e-03, -9.0330852e-15, -3.0969336e-15,  8.9872007e-03,  7.6753782e-15, -4.2224218e-14,  6.9789697e-03,  1.9325126e-14,  1.9463331e-14, -2.1856854e-03, -3.7257452e-14, -1.1769689e-14, -9.1064504e-03,  1.5227598e-14, -1.0597966e-14,  8.9871998e-03, -1.2501195e-12, -5.8301206e-13, -3.8477819e-02,  3.8978589e-14, -3.4771393e-14, -5.0040811e-04,  1.0064480e-12,  2.0394987e-12,  1.0437904e-01,  5.3142216e-15,  2.3275283e-14, -3.0977404e-02,  1.2724971e-13, -1.2303928e-12, -3.8477888e-02, -5.1798238e-14, -1.3784853e-14, -5.0041417e-04],
[ 1.9878132e-03, -7.9170992e-04,  1.5535061e-14,  1.4494575e-04, -2.6716351e-04, -3.1653880e-17,  9.1154862e-05, -1.0499612e-03, -2.0029354e-15,  6.0037340e-07,  1.3583948e-04,  9.1577392e-16, -3.1684265e-03, -4.0727850e-03, -5.1420297e-15, -1.0594486e-03,  9.6252098e-04,  6.4624898e-16, -1.5596104e-02,  1.6422764e-02, -4.3250900e-14,  8.2339787e-04, -9.0399469e-05, -1.2685786e-14, -2.7346466e-01,  1.2669378e-01,  5.3142216e-15,  2.8663062e-01, -1.3360207e-01, -2.6189534e-14,  2.7452879e-03, -4.4073040e-03,  6.5565846e-14,  8.6481543e-04,  6.6489001e-05,  1.3256878e-15],
[-1.0958101e-03, -5.9769556e-03,  1.2181102e-14,  1.6578773e-03, -6.5798435e-04, -3.9447678e-16, -1.0499654e-03, -1.1212211e-03, -2.0439867e-14,  1.3583921e-04,  1.5745448e-04, -4.7344861e-16, -3.7686766e-03, -8.2071025e-04, -5.8938109e-15, -9.6252134e-04,  5.4641221e-04, -7.0275379e-16, -1.4996753e-02,  9.6824382e-03,  3.6206455e-14,  4.2578129e-05,  8.5100910e-04, -9.0057934e-15,  1.2669379e-01, -1.2717126e-01,  2.3275283e-14, -1.3360207e-01,  1.3236023e-01, -2.8405777e-14,  2.7012201e-02, -8.6590049e-03,  1.0341066e-14, -6.6488355e-05,  8.0959462e-04, -1.6687979e-14],
[-3.1437398e-14,  3.5577238e-14,  8.9872000e-03, -8.1344367e-16,  1.6263132e-15,  6.5196660e-06, -2.7954966e-15,  4.0847230e-14, -2.1856718e-03,  3.8127740e-16, -1.8970854e-15, -1.1185270e-03,  1.1419505e-14,  1.5776203e-14,  8.9871903e-03, -7.5767553e-16, -5.0478688e-16,  6.5154226e-06, -2.7542910e-13,  4.6842164e-14, -5.0039882e-04, -1.4169802e-14, -9.4528003e-15, -3.1326034e-03,  1.3704813e-13,  2.5773975e-13, -3.0977404e-02, -2.6189534e-14, -2.8405777e-14,  2.3560197e-02,  2.0015751e-13, -3.3864739e-13, -5.0041391e-04,  2.5860291e-15, -1.9501063e-14, -3.1326036e-03],
[-2.9663673e-01,  1.2871366e-01,  8.4804118e-13,  3.9802713e-03, -5.1203137e-03,  5.4436336e-14, -4.5579108e-02, -1.0758256e-02,  2.4699605e-13, -3.1684315e-03, -3.7686795e-03, -4.2006247e-15, -1.3366408e-02,  1.6934487e-02, -2.2798971e-13,  9.1152817e-05,  1.0499652e-03,  6.8134145e-15,  2.0771933e-02, -2.7549572e-02, -9.5787352e-14, -4.8030821e-03, -3.1290087e-03,  9.6265032e-15, -1.0980628e-01, -2.0846945e-02,  1.2724971e-13,  2.7452879e-03,  2.7012201e-02,  2.0015751e-13,  7.1923605e-01,  2.4156251e-02, -1.0221770e-12, -2.7346466e-01, -1.2669379e-01, -1.4316601e-13],
[ 8.7019743e-02, -1.7208300e-01, -5.6620280e-13,  2.6299175e-02, -9.8939868e-03, -1.3938849e-13,  1.0758246e-02,  4.2888812e-02, -1.4108433e-13, -4.0727806e-03, -8.2070430e-04, -6.4638361e-15,  1.6934496e-02, -3.2920668e-02,  3.7669908e-13,  1.0499629e-03, -1.1212234e-03,  3.0411888e-15, -4.9066028e-02, -2.3462212e-02, -1.7345622e-13, -2.8249191e-03,  8.1394873e-04,  3.2395717e-14,  2.0846938e-02, -3.5891368e-01, -1.2303928e-12, -4.4073040e-03, -8.6590049e-03, -3.3864739e-13,  2.4156251e-02,  6.9134299e-01,  1.9466274e-12, -1.2669378e-01, -1.2717126e-01,  2.3687243e-13],
[ 9.6076720e-13, -4.5510042e-13, -3.8477816e-02, -1.5907448e-14, -2.6216464e-14, -5.0039614e-04,  1.5907717e-13,  1.7486754e-13, -9.1064489e-03, -1.2073829e-14, -7.3177909e-15,  8.9871978e-03,  1.2569453e-14, -4.3139678e-14,  6.9789632e-03, -2.4473536e-14,  1.5100493e-14, -2.1856958e-03,  1.2987414e-14, -2.0323147e-13, -9.1063387e-03,  1.9931493e-14, -6.4694761e-15,  8.9871931e-03, -1.4659860e-13, -1.4244781e-12, -3.8477888e-02,  6.5565846e-14,  1.0341066e-14, -5.0041391e-04, -1.0221770e-12,  1.9466274e-12,  1.0437904e-01, -9.6681760e-15,  1.9016864e-14, -3.0977396e-02],
[-1.5596100e-02, -1.6422765e-02,  2.9432768e-14,  8.2339777e-04,  9.0399342e-05,  1.0885013e-14, -3.1684300e-03,  4.0727830e-03,  3.1492022e-16, -1.0594481e-03, -9.6252175e-04, -7.5716044e-17,  9.1151530e-05,  1.0499653e-03,  8.1080318e-15,  6.0046679e-07, -1.3583885e-04,  3.7797884e-16,  1.9878157e-03,  7.9170917e-04, -6.7769381e-15,  1.4494571e-04,  2.6716247e-04,  1.2669254e-15,  2.7452871e-03,  4.4073007e-03, -5.1798238e-14,  8.6481543e-04, -6.6488355e-05,  2.5860291e-15, -2.7346466e-01, -1.2669378e-01, -9.6681760e-15,  2.8663062e-01,  1.3360207e-01,  1.5347401e-14],
[ 1.4996752e-02,  9.6824383e-03,  5.3846077e-14, -4.2577963e-05,  8.5100935e-04, -4.2610905e-15,  3.7686769e-03, -8.2071040e-04,  1.5560387e-14,  9.6252118e-04,  5.4641176e-04, -7.6521999e-16,  1.0499640e-03, -1.1212208e-03, -1.4974553e-14, -1.3583905e-04,  1.5745488e-04, -2.2079647e-16,  1.0958096e-03, -5.9769552e-03, -2.8039331e-15, -1.6578776e-03, -6.5798452e-04,  7.6983919e-16, -2.7012200e-02, -8.6590041e-03, -1.3784853e-14,  6.6489001e-05,  8.0959462e-04, -1.9501063e-14, -1.2669379e-01, -1.2717126e-01,  1.9016864e-14,  1.3360207e-01,  1.3236023e-01, -3.2881657e-14],
[ 3.6230575e-13,  2.2893815e-16, -5.0042144e-04,  1.7117913e-14, -6.0008644e-15, -3.1326030e-03, -4.7227360e-14, -1.0057779e-14,  8.9872228e-03, -1.9603844e-15, -1.8534065e-16,  6.5233979e-06, -3.1201743e-14,  2.0536150e-14, -2.1856967e-03,  4.2531230e-16, -1.3721983e-15, -1.1185361e-03,  2.2751042e-15,  1.8570798e-14,  8.9872080e-03,  9.4477565e-17, -6.8357126e-16,  6.5150387e-06, -1.7533614e-13, -2.0833893e-13, -5.0041417e-04,  1.3256878e-15, -1.6687979e-14, -3.1326036e-03, -1.4316601e-13,  2.3687243e-13, -3.0977396e-02,  1.5347401e-14, -3.2881657e-14,  2.3560202e-02]
])

# Mass in Dalton
m = np.array([12, 1.00782504, 12, 1.00782504, 12, 1.00782504, 12, 1.00782504, 12, 1.00782504, 12, 1.00782504])

# X in Angstrom
xyz = np.array([
    [ -1.68294627e-07,   1.40795600e+00,  -5.72458678e-24],
    [ -2.99086588e-07,   2.50216400e+00,  -5.72458678e-24],
    [ -1.21932575e+00,   7.03977853e-01,  -1.49324333e-16],
    [ -2.16693773e+00,   1.25108174e+00,  -2.65373324e-16],
    [ -1.21932558e+00,  -7.03978144e-01,  -1.49324333e-16],
    [ -2.16693744e+00,  -1.25108226e+00,  -2.65373324e-16],
    [  1.68294627e-07,  -1.40795600e+00,  -5.72458678e-24],
    [  2.99086588e-07,  -2.50216400e+00,  -5.72458678e-24],
    [  1.21932575e+00,  -7.03977853e-01,   1.49324321e-16],
    [  2.16693773e+00,  -1.25108174e+00,   2.65373312e-16],
    [  1.21932558e+00,   7.03978144e-01,   1.49324321e-16],
    [  2.16693744e+00,   1.25108226e+00,   2.65373312e-16]])

m_rep = np.repeat(m, 3)*DALTON2AU

mw_K = np.zeros(k.shape)
for i in range(len(m_rep)):
    for j in range(len(m_rep)):
        mw_K[i, j] = k[i, j]/np.sqrt(m_rep[i])/np.sqrt(m_rep[j])

'''
# Check K criteria
print('Is the K = K^T?')
print(np.allclose(mw_K, mw_K.transpose(), atol=1e-15))
'''
w2, mw_normal_mode = np.linalg.eigh(mw_K)

# Take the square root of frequency square and transform the unit to cm-1
w2 = w2 * (1 + 0j)
w = np.sqrt(w2)
w *= HARTREE2CM

# Transform the mass-weighted coordinate to the normal mode
normal_mode = mw_normal_mode / np.sqrt(m_rep)
total = np.transpose(normal_mode)@normal_mode
total = np.sum(total, axis=0)
normal_mode /= np.sqrt(total)

# Start the plot
ax = plt.gca(projection='3d')

x = xyz[:, 0]  # N 個原子的 x 座標
y = xyz[:, 1]  # N 個原子的 y 座標
z = xyz[:, 2]  # N 個原子的 z 座標
ax.scatter3D(x, y, z)

ax.set_xlim([-2, 2])
ax.set_ylim([-2, 2])
ax.set_zlim([-2, 2])

ax.view_init(90, 90)  # 選擇xy平面
# ax.view_init(90,  0)  # 選擇xz平面
# ax.view_init(0,  0)  # 選擇yz平面

mode1 = normal_mode[:, -2].reshape(-1, 3)
u = mode1[:, 0]
v = mode1[:, 1]
w = mode1[:, 2]

ax.quiver3D(x, y, z, u, v, w, color='red', arrow_length_ratio=0.5)

plt.show()
